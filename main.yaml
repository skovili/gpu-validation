---
- name: GPU Validation VM setup
  hosts: control_node
  gather_facts: false
  pre_tasks:
    - name: Install Ansible Galaxy role requirements
      ansible.builtin.command:
        cmd: ansible-galaxy role install -r requirements.yaml --force
        chdir: "{{ playbook_dir }}"
      changed_when: true
  tasks:
    - name: VM Pre-tasks
      ansible.builtin.include_role:
        name: gpu-validation
        tasks_from: vm_pre.yaml
  tags: rhoso

- name: GPU Validation
  hosts: target_nodes
  gather_facts: false
  roles:
    - gpu-validation

- name: GPU Validation VM cleanup
  hosts: control_node
  gather_facts: false
  tasks:
    - name: VM Post-tasks
      ansible.builtin.include_role:
        name: gpu-validation
        tasks_from: vm_post.yaml
  tags: rhoso
